# Git AI - GitLab CI Configuration
# Add this job to your .gitlab-ci.yml file
#
# SETUP: Create a GITLAB_TOKEN variable with API and push access.
#
# Note: CI_JOB_TOKEN (auto-provided) often lacks API query permissions.
#       Setting GITLAB_TOKEN explicitly ensures proper access.
#
# 1. Settings > Access tokens > Add new token
#    - Name: git-ai
#    - Role: Maintainer
#    - Scope: write_repository (required for API queries and pushing)
# 2. Settings > CI/CD > Variables > Add variable
#    - Key: GITLAB_TOKEN
#    - Value: <paste token>
#    - Masked: checked

git-ai:
  stage: build
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH && $CI_PIPELINE_SOURCE == "push"
      when: always
  script:
    - curl -fsSL https://usegitai.com/install.sh | bash
    - export PATH="$HOME/.git-ai/bin:$PATH"
    - git config --global user.name "gitlab-ci[bot]"
    - git config --global user.email "gitlab-ci[bot]@users.noreply.gitlab.com"
    - git-ai ci gitlab run

